# ClamAV Node Worker

This has been adapated from [GoogleCloudPlatform/docker-clamav-malware-scanner][gcp-malware]
to use Google Pub/Sub rather than Eventarc for notifications, to support
calling a ClamAV daemon running on another host, and to run within GKE.

# Setup
This app can be configure in 2 ways:
1. by editing `config.js`
2. by setting ENVIRONMENT variables (preferred)

## 1. `config.js`
To configure using `config.js`, edit the file and start the application
with the environment variable `CONFIG_FILEE=./config.js`.

## 2. `env`
To configure using environment variables, **ALL** of the following environment
variables **MUST** be specified. They do not currently use any default values.

```sh
UNSCANNED_BUCKET=my-bucket-unscanned
CLEAN_BUCKET=my-bucket-scanned
QUARANTINED_BUCKET=my-bucket-quarantined
UPLOAD_TOPIC=projects/my-project/topics/my-topic
CLAMD_HOST=127.0.0.1 # dns names also work here
CLAMD_PORT=3310
```

[gcp-malware]: https://github.com/GoogleCloudPlatform/docker-clamav-malware-scanner "GoogleCloudPlatform/docker-clamav-malware-scanner"
